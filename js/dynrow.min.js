!function($){function Fill(){this.defaults={styleElementName:"none",dateFormat:"mm/dd/yy",debug:!1,elementsExecuteEvents:["checkbox","radio","select-one"]}}function executeEvents(e){jQuery.inArray($(e).attr("type"),$.fill.defaults.elementsExecuteEvents)&&($(e).attr("onchange")&&$(e).change(),$(e).attr("onclick")&&$(e).click())}function debug(e){window.console&&window.console.log&&window.console.log(e)}var config={open:"{{",close:"}}",reference:"d"},tool={exp:function(e){return new RegExp(e,"g")},query:function(e,t,n){var a=["#([\\s\\S])+?","([^{#}])*?"][e||0];return exp((t||"")+config.open+a+config.close+(n||""))},escape:function(e){return String(e||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},error:function(e,t){var n="Laytpl Error：";return"object"==typeof console&&console.error(n+e+"\n"+(t||"")),n+e}},exp=tool.exp,Tpl=function(e){this.tpl=e};Tpl.pt=Tpl.prototype,Tpl.pt.parse=function(e,t){var n=this,a=e,i=exp("^"+config.open+"#",""),o=exp(config.close+"$","");e=e.replace(/[\r\t\n]/g," ").replace(exp(config.open+"#"),config.open+"# ").replace(exp(config.close+"}"),"} "+config.close).replace(/\\/g,"\\\\").replace(/(?="|')/g,"\\").replace(tool.query(),function(e){return e=e.replace(i,"").replace(o,""),'";'+e.replace(/\\/g,"")+'; view+="'}).replace(tool.query(1),function(e){var t='"+(';return e.replace(/\s/g,"")===config.open+config.close?"":(e=e.replace(exp(config.open+"|"+config.close),""),/^=/.test(e)&&(e=e.replace(/^=/,""),t='"+_escape_('),t+e.replace(/\\/g,"")+')+"')}),e='"use strict";var view = "'+e+'";return view;';try{return n.cache=e=new Function(""+config.reference+", _escape_",e),e(t,tool.escape)}catch(e){return delete n.cache,tool.error(e,a)}},Tpl.pt.render=function(e,t){var n,a=this;return e?(n=a.cache?a.cache(e,tool.escape):a.parse(a.tpl,e),t?void t(n):n):tool.error("no data")};var laytpl=function(e){return"string"!=typeof e?tool.error("Template not found"):new Tpl(e)};laytpl.config=function(e){e=e||{};for(var t in e)config[t]=e[t]},$.extend(Fill.prototype,{setDefaults:function(e){return this.defaults=$.extend({},this.defaults,e),this},fill:function(obj,_element,settings){null==settings&&(settings={});var options=$.extend({},this.defaults,settings);_element.find("*").each(function(i,item){if($(item).is("input")||$(item).is("select")||$(item).is("textarea"))try{var objName,arrayAtribute;try{"object"==options.styleElementName?$(item).attr("name").match(/\[[0-9]*\]/i)?(objName=$(item).attr("name").replace(/^[a-z]*[0-9]*[a-z]*\./i,"obj.").replace(/\[[0-9]*\].*/i,""),arrayAtribute=$(item).attr("name").match(/\[[0-9]*\]\.[a-z0-9]*/i)+"",arrayAtribute=arrayAtribute.replace(/\[[0-9]*\]\./i,"")):objName=$(item).attr("name").replace(/^[a-z]*[0-9]*[a-z]*\./i,"obj."):"none"==options.styleElementName&&(objName="obj."+$(item).attr("name"));var value=eval(objName)}catch(e){options.debug&&debug(e.message)}if(null!=value){switch(item.type){case"hidden":case"password":case"textarea":$(item).val(value);break;case"text":if($(item).hasClass("hasDatepicker")){var re=/^[-+]*[0-9]*$/,dateValue=null;if(re.test(value)){dateValue=new Date(parseInt(value));var strDate=dateValue.getUTCFullYear()+"-"+(dateValue.getUTCMonth()+1)+"-"+dateValue.getUTCDate();dateValue=$.datepicker.parseDate("yy-mm-dd",strDate)}else value&&(dateValue=$.datepicker.parseDate(options.dateFormat,value));$(item).datepicker("setDate",dateValue)}else"double"==$(item).attr("alt")?$(item).val(value.toFixed(2)):$(item).val(value);break;case"select-one":value&&$(item).val(value);break;case"radio":$(item).each(function(e,t){$(t).val()==value&&$(t).prop("checked","checked")});break;case"checkbox":if($.isArray(value))$.each(value,function(i,arrayItem){"object"==typeof arrayItem?arrayItemValue=eval("arrayItem."+arrayAtribute):arrayItemValue=arrayItem,$(item).val()==arrayItemValue&&$(item).attr("checked","checked")});else for(var values=value.split(","),i=0;i<values.length;i++)if(values[i]==$(item).val()){$(item).attr("checked","checked");break}}executeEvents(item)}}catch(e){options.debug&&debug(e.message)}})}}),$.fn.fill=function(e,t){return $.fill.fill(e,$(this),t),this},$.fill=new Fill;var DynamicRow=function(e,t){if(this.$element=$("#"+e),this.option=$.extend({},this.DEFAULT,t),t.reference&&laytpl.config({reference:t.reference}),!this.$element.length)throw Error("初始化时table id 未获取到...");this.init()};DynamicRow.version="1.1.0",DynamicRow.prototype={init:function(){this.keyClass=this.guid(),this._addEvent(),this._echoListLine()},DEFAULT:{tmplId:"",addNextId:null,position:!1,selector:"[data-table='dynrow']",params:null,deflutOne:!0,deleteLast:!0,fnAdd:null,fnDel:null,fnDelBefore:null,echoData:null,echoForm:null,checkRow:"[data-table='rowspan']"},_addLine:function(e,t){var n=this.option,a=$(t),i=n.position?"before":"after";a.addClass(this.keyClass),this.isEmpty&&(i="append"),$(e)[i](a),this._addRowspan(),"function"==typeof n.fnAdd&&n.fnAdd.call(this,a)},_addEvent:function(){var e=this,t=e.option;e.$element.on("click",t.selector,function(n){return!$(this).hasClass("delete")&&(e._getLaytpl(t.tmplId,t.params,function(t){e._addLine(e._getAddDom(),t)}),!1)}),e.$element.on("click",".delete",function(t){return e._deleteRow($(this).closest("tr")),!1})},_echoListLine:function(){var e=this,t=e.option.echoData;t?e._insertData(t):e._addDefaultLine()},_insertData:function(e){var t=this,n="";for(a in e)n=a;for(var a=0;a<e[n].length;a++)t.addRow();if(!t.option.echoForm)throw Error("回显数据或formid填写错误！！");$("#"+t.option.echoForm).fill(e)},_addDefaultLine:function(){var e=this;e.option.deflutOne&&e.addRow()},_getAddDom:function(){var e=this.$element.find("#"+this.option.addNextId);return this.isEmpty=!1,0===e.length&&(e=this.$element.find("."+this.keyClass)),0===e.length&&(this.isEmpty=!0,e=this.$element),e.length>1?e[e.length-1]:e},_getLaytpl:function(e,t,n){var a=document.getElementById(e).innerHTML;laytpl(a).render(t?t:{},function(e){n.call(void 0,e)})},_deleteRow:function(e){var t=this,n=t.option,a=t.$element.find("."+t.keyClass).length;return!(!n.deleteLast&&1===a)&&(("function"!==n.fnDelBefore||0!=n.fnDelBefore.call({},e))&&(e.remove(),t._minusRowspan(),void("function"==typeof n.fnDel&&n.fnDel.call({},a-1))))},_addRowspan:function(e){var t=this.$element.find(this.option.checkRow);if(t.length){var e=t[t.length-1];e.setAttribute("rowspan",parseInt(e.getAttribute("rowspan"),10)+1)}},_minusRowspan:function(e){var t=this.$element.find(this.option.checkRow);if(t.length){var e=t[t.length-1];e.setAttribute("rowspan",parseInt(e.getAttribute("rowspan"),10)-1)}},addRow:function(){var e=this;e._getLaytpl(e.option.tmplId,e.option.params,function(t){e._addLine(e._getAddDom(),t)})},deleteRow:function(e){var t=this,n=t.$element.find("."+t.keyClass);if(n.length){var a=n["number"==typeof e?e:n.length-1];a&&t._deleteRow($(a))}},clearAll:function(){var e=this,t=e.$element.find("."+e.keyClass);if(t.length)for(var n=0;n<t.length;n++)$(t[n]).remove(),e._minusRowspan()},getRow:function(e){var t=null,n=this.$element.find("."+this.keyClass);if(n.length)try{t=n["number"==typeof e?e:n.length-1]}catch(e){}return t},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}).toUpperCase()}},DynamicRow.v="1.0";var Dynrow=DynamicRow;"function"==typeof define?define(function(){return Dynrow}):"undefined"!=typeof exports?module.exports=Dynrow:window.Dynrow=Dynrow}(jQuery);