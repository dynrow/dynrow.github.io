!function($){function Fill(){this.defaults={styleElementName:"none",dateFormat:"mm/dd/yy",debug:!1,elementsExecuteEvents:["checkbox","radio","select-one"]}}function executeEvents(e){jQuery.inArray($(e).attr("type"),$.fill.defaults.elementsExecuteEvents)&&($(e).attr("onchange")&&$(e).change(),$(e).attr("onclick")&&$(e).click())}function debug(e){window.console&&window.console.log&&window.console.log(e)}var config={open:"{{",close:"}}",reference:"d"},tool={exp:function(e){return new RegExp(e,"g")},query:function(e,t,n){var a=["#([\\s\\S])+?","([^{#}])*?"][e||0];return exp((t||"")+config.open+a+config.close+(n||""))},escape:function(e){return String(e||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},error:function(e,t){var n="Laytpl Error：";return"object"==typeof console&&console.error(n+e+"\n"+(t||"")),n+e}},exp=tool.exp,Tpl=function(e){this.tpl=e};Tpl.pt=Tpl.prototype,Tpl.pt.parse=function(e,t){var n=this,a=e,i=exp("^"+config.open+"#",""),o=exp(config.close+"$","");e=e.replace(/[\r\t\n]/g," ").replace(exp(config.open+"#"),config.open+"# ").replace(exp(config.close+"}"),"} "+config.close).replace(/\\/g,"\\\\").replace(/(?="|')/g,"\\").replace(tool.query(),function(e){return e=e.replace(i,"").replace(o,""),'";'+e.replace(/\\/g,"")+'; view+="'}).replace(tool.query(1),function(e){var t='"+(';return e.replace(/\s/g,"")===config.open+config.close?"":(e=e.replace(exp(config.open+"|"+config.close),""),/^=/.test(e)&&(e=e.replace(/^=/,""),t='"+_escape_('),t+e.replace(/\\/g,"")+')+"')}),e='"use strict";var view = "'+e+'";return view;';try{return n.cache=e=new Function(""+config.reference+", _escape_",e),e(t,tool.escape)}catch(l){return delete n.cache,tool.error(l,a)}},Tpl.pt.render=function(e,t){var n,a=this;return e?(n=a.cache?a.cache(e,tool.escape):a.parse(a.tpl,e),t?void t(n):n):tool.error("no data")};var laytpl=function(e){return"string"!=typeof e?tool.error("Template not found"):new Tpl(e)};laytpl.config=function(e){e=e||{};for(var t in e)config[t]=e[t]},$.extend(Fill.prototype,{setDefaults:function(e){return this.defaults=$.extend({},this.defaults,e),this},fill:function(obj,_element,settings){null==settings&&(settings={});var options=$.extend({},this.defaults,settings);_element.find("*").each(function(i,item){if($(item).is("input")||$(item).is("select")||$(item).is("textarea"))try{var objName,arrayAtribute;try{"object"==options.styleElementName?$(item).attr("name").match(/\[[0-9]*\]/i)?(objName=$(item).attr("name").replace(/^[a-z]*[0-9]*[a-z]*\./i,"obj.").replace(/\[[0-9]*\].*/i,""),arrayAtribute=$(item).attr("name").match(/\[[0-9]*\]\.[a-z0-9]*/i)+"",arrayAtribute=arrayAtribute.replace(/\[[0-9]*\]\./i,"")):objName=$(item).attr("name").replace(/^[a-z]*[0-9]*[a-z]*\./i,"obj."):"none"==options.styleElementName&&(objName="obj."+$(item).attr("name"));var value=eval(objName)}catch(e){options.debug&&debug(e.message)}if(null!=value){switch(item.type){case"hidden":case"password":case"textarea":$(item).val(value);break;case"text":if($(item).hasClass("hasDatepicker")){var re=/^[-+]*[0-9]*$/,dateValue=null;if(re.test(value)){dateValue=new Date(parseInt(value));var strDate=dateValue.getUTCFullYear()+"-"+(dateValue.getUTCMonth()+1)+"-"+dateValue.getUTCDate();dateValue=$.datepicker.parseDate("yy-mm-dd",strDate)}else value&&(dateValue=$.datepicker.parseDate(options.dateFormat,value));$(item).datepicker("setDate",dateValue)}else $(item).val("double"==$(item).attr("alt")?value.toFixed(2):value);break;case"select-one":value&&$(item).val(value);break;case"radio":$(item).each(function(e,t){$(t).val()==value&&$(t).prop("checked","checked")});break;case"checkbox":if($.isArray(value))$.each(value,function(i,arrayItem){arrayItemValue="object"==typeof arrayItem?eval("arrayItem."+arrayAtribute):arrayItem,$(item).val()==arrayItemValue&&$(item).attr("checked","checked")});else for(var values=value.split(","),i=0;i<values.length;i++)if(values[i]==$(item).val()){$(item).attr("checked","checked");break}}executeEvents(item)}}catch(e){options.debug&&debug(e.message)}})}}),$.fn.fill=function(e,t){return $.fill.fill(e,$(this),t),this},$.fill=new Fill;var DynamicRow=function(e,t){if(this.$element=$("#"+e),this.option=$.extend({},this.DEFAULT,t),t.reference&&laytpl.config({reference:t.reference}),!this.$element.length)throw Error("初始化时table id 未获取到...");this.init()};DynamicRow.prototype={init:function(){this.keyClass=this.guid(),this.isRow=!0,this.addClickLine(),this.deleteLine(),this.echoListLine()},DEFAULT:{tmplId:"",addNextId:null,selector:"[data-table='dynrow']",params:null,deflutOne:!0,addLineNum:0,deleteLast:!0,callback:null,deleteback:null,echoData:null,echoForm:null,checkRow:"[data-table='rowspan']"},addLine:function(e,t){var n=(this.option,$(t));n.addClass(this.keyClass),$(e).after(n),this.option.addLineNum++,this.addRowspan(),"function"==typeof this.option.callback&&this.option.callback.call(this,n)},addClickLine:function(){var e=this;e.$element.on("click",e.option.selector,function(){return $(this).hasClass("delete")?!1:(e.getLaytpl(e.option.tmplId,e.option.params,function(t){var n=e.$element.find("."+e.keyClass);0===n.length&&(n=e.getAddDom()),e.addLine(n[n.length-1],t)}),!1)})},echoListLine:function(){var e=this,t=e.option.echoData;t?e.insertData(t):e.addDefaultLine()},insertData:function(e){var t=this,n="";for(a in e)n=a;for(var a=0;a<e[n].length;a++)t.addOneLine();if(!t.option.echoForm)throw Error("回显数据或formid填写错误！！");$("#"+t.option.echoForm).fill(e)},replacement:function(){var e=this,t=e.$element.find("."+e.keyClass);if(t.length)for(var n=0;n<t.length;n++)$(t[n]).remove(),e.minusRowspan()},addDefaultLine:function(){var e=this;e.option.deflutOne&&e.getLaytpl(e.option.tmplId,e.option.params,function(t){var n=e.getAddDom();e.addLine(n,t)})},addOneLine:function(){var e=this;e.getLaytpl(e.option.tmplId,e.option.params,function(t){var n=e.getAddDom();e.addLine(n,t)})},getAddDom:function(){var e=this,t=e.$element.find("."+e.keyClass);return 0===t.length&&(t=e.$element.find("#"+e.option.addNextId)),0===t.length&&(t=e.$element.find("tr")),t.length>1?t[t.length-1]:t},getLaytpl:function(e,t,n){var a=document.getElementById(e).innerHTML;laytpl(a).render(t?t:{},function(e){n.call(void 0,e)})},deleteLine:function(){var e=this;e.$element.on("click",".delete",function(){return 1!=e.option.addLineNum||e.option.deleteLast?(e.minusRowspan(),$(this).closest("tr").remove(),e.option.addLineNum--,"function"==typeof e.option.deleteback&&e.option.deleteback.call(e,e.$element.find("."+e.keyClass).length),!1):void("function"==typeof e.option.deleteback&&e.option.deleteback.call(e,e.$element.find("."+e.keyClass).length))})},deleteLastLine:function(){var e=this,t=e.$element.find("."+e.keyClass);t.length&&($(t[t.length-1]).remove(),e.minusRowspan(),"function"==typeof e.option.deleteback&&e.option.deleteback.call(e,e.$element.find("."+e.keyClass).length))},addRowspan:function(e){var t=this.$element.find(this.option.checkRow);if(t.length){var e=t[t.length-1];e.setAttribute("rowspan",parseInt(e.getAttribute("rowspan"),10)+1)}},minusRowspan:function(e){var t=this.$element.find(this.option.checkRow);if(t.length){var e=t[t.length-1];e.setAttribute("rowspan",parseInt(e.getAttribute("rowspan"),10)-1)}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}).toUpperCase()}},DynamicRow.v="1.0";var Dynrow=DynamicRow;"function"==typeof define?define(function(){return Dynrow}):"undefined"!=typeof exports?module.exports=Dynrow:window.Dynrow=Dynrow}(jQuery);